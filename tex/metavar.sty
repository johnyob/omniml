%%% Package metavar

\RequirePackage{kvoptions}
\RequirePackage{keyval}

\DeclareBoolOption [false]{types}
\DeclareBoolOption[false]{i}\DeclareComplementaryOption{I}{i}
\DeclareBoolOption[false]{j}\DeclareComplementaryOption{J}{j}
\DeclareBoolOption[false]{k}\DeclareComplementaryOption{K}{k}
\DeclareBoolOption[false]{s}\DeclareComplementaryOption{S}{s}
\DeclareBoolOption[false]{n}\DeclareComplementaryOption{N}{n}
\DeclareBoolOption[false]{as}
\DeclareBoolOption[false]{bs}
\DeclareBoolOption[false]{ps}
\ProcessKeyvalOptions*

\def \mva@@newcommand #1#2\relax#3#4%
    {\expandafter \let \expandafter \@tmp \csname #2#3\endcsname
     \ifx \@tmp \relax
       \expandafter \newcommand \csname #2#3\endcsname {#4}%
     \else
       \PackageWarning {metavar}
       {Command \expandafter \string \csname #2#3\endcsname\space
        not redefined}%
     \fi}
\def \mva@newcommand
    #1#2#3{\expandafter \mva@@newcommand \string#1\relax{#2}{#3}}

\newcommand {\setmetavar} [1]{\setkeys{metavar}{#1}}
\define@key {metavar}{i}[]{\metavar@itrue}
\define@key {metavar}{j}[]{\metavar@jtrue}
\define@key {metavar}{k}[]{\metavar@ktrue}
\define@key {metavar}{s}[]{\metavar@strue}
\define@key {metavar}{S}[]{\metavar@sfalse}
\define@key {metavar}{n}[]{\metavar@ntrue}
\define@key {metavar}{as}[]{\metavar@astrue}
\define@key {metavar}{bs}[]{\metavar@bstrue}
\define@key {metavar}{ps}[]{\metavar@pstrue}


\newcommand{\defmetavar}[3][]{%
  \newcommand {#2}{#3}%
  \mva@newcommand {#2}{p}{{#3'}}%
  \mva@newcommand {#2}{pp}{{#3''}}%
  \mva@newcommand {#2}{i}{{#3_i}}%
  \mva@newcommand {#2}{ip}{{#3'_i}}%
  \mva@newcommand {#2}{z}{{#3_0}}%
  \mva@newcommand {#2}{a}{{#3_1}}%
  \mva@newcommand {#2}{b}{{#3_2}}%
  \mva@newcommand {#2}{c}{{#3_3}}%
  \mva@newcommand {#2}{zp}{{#3_0'}}%
  \mva@newcommand {#2}{ap}{{#3_1'}}%
  \mva@newcommand {#2}{bp}{{#3_2'}}%
  \let \mva@do \empty%
  \def \mva@add ##1##2{%
    \csname ifmetavar@##1\endcsname
       \g@addto@macro \mva@do{\mva@newcommand{#2}{##1}{##2}}\fi}%
  \begingroup
  \setmetavar{#1}%
  \mva@add{i}{{#3_i}}%
  \mva@add{j}{{#3_j}}%
  \mva@add{k}{{#3_k}}%
  \mva@add{n}{{#3_n}}%
  \mva@add{s}{{\bar #3}}%
  \mva@add{as}{{\bar #3_1}}%
  \mva@add{bs}{{\bar #3_2}}%
  \mva@add{ps}{{\bar #3'}}%
  \endgroup
  \mva@do
  \let \mva@do \empty
}

\newcommand {\defmetatypes}{%
  \defmetavar \tv \alpha
  \defmetavar \tw \beta
  \let \t \relax \defmetavar \t \tau
}
\ifmetavar@types \defmetatypes \fi
